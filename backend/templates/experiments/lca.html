{% extends "layout.html" %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<!-- The library for the charts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
<!-- The library for the pdf creation -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.1.1/jspdf.umd.min.js" type="module"></script>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<!-- scripts to run LCA, will need to be changed later-->
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/select/1.3.1/css/select.dataTables.min.css">
{% endblock %}


{% block content %}
<div class="container mx-auto p-4"
     x-data="{fileSelected: false, processCount: 0, csvFiles: []}">
  <div class="flex flex-col justify-center">

    <!-- LCA Header -->
    <header class="flex flex-col mt-4 mb-2">
      <div class="mb-2">
        <h2 class="text-3xl font-medium mb-2">Life Cycle Assessment (LCA)</h2>
        <div>Manuals, case studies, and databases are available
          <a href="https://webpages.uidaho.edu/rsml/manual.html" class="font-bold">here.</a>
        </div>
      </div>
    </header>

    <!-- Phase 1 -->
    <div class="flex flex-col space-y-4 mb-2 mt-4 py-4 px-2 border-y border-gray-400">
      <h3 id="scopeHeader" class="mb-2 font-bold text-xl">Goal and scope</h3>

      <div class="flex flex-col mb-4">
        <h4 id="infoHeader" class="mb-2 max-w-xs font-medium">Name of the project</h4>
        <input id="projectName" type="text" class="w-64 px-2 py-1 border border-gray-400 rounded-lg bg-white" name="projectName" placeholder="Name of the project" />
      </div>

      <div class="flex flex-col mb-2 font-medium">
        <h4 class="font-medium mb-2">Project Description</h4>
        <textarea id="phase1Text" name="phase1Text" rows="2" cols="50" class="resize w-64 px-2 py-1 border border-gray-400 rounded-lg bg-white"> </textarea>
      </div>
    </div>


    <!-- Phase 2 -->
    <div class="px-2 py-4 flex flex-col space-y-2 border-b border-gray-400">
      <h3 id="phase2Header" class="mb-2 text-xl font-bold">Life cycle inventory (LCI)</h3>
      <div x-show="processCount > 0" x-cloak>
        <template x-for="(count, index) in processCount">
          <div class="mb-4">
            <input type="file"
                   @change="fileSelected=$el.files[0];csvFiles=getCSVFiles('input-csv');upload(event, index)"
                   class="input-csv file:px-2 file:py-1 file:my-1 file:bg-violet-500 file:text-white file:font-medium file:text-sm file:rounded-full file:border-none"
                   name="File Upload" accept=".csv" />
            <table :id="'CSVtable_'+index" class="display"></table>
          </div>
        </template>
      </div>
      <button @click="if(processCount < 4) processCount++;"
              class="w-64 px-2 py-1 bg-white rounded-md border border-slate-400 my-2">
        Add Process
      </button>
      <div x-show="processCount > 0" x-cloak class="mt-6">
        <h4><span x-text="processCount"></span>/4 Processes</h4>
        <label id="csvTableErrorMessage_1" value="" style="color:red"></label>
      </div>
    </div>



    <!-- Phase 3 -->
    <div x-cloak x-show="processCount > 0" class="flex flex-col mb-2 py-4 px-2 border-b border-gray-400">
      <h3 id="methodHeader" class="text-xl font-bold mb-2">Life cycle impact assessment (LCIA)</h3>

      <!-- Calculator -->
      <div class="flex flex-col ">
        <h4 class="text-lg font-bold mb-2">Enter formula for LCA methods</h4>
        <div class="flex flex-col">
          <template x-for="(count, index) in processCount">
            <div class="input-equation flex items-center mb-2">
              <input type="text" name="label" :value="'Process '+(index+1)" class="py-1 px-2 mr-2 border border-gray-400 rounded-lg" placeholder="Rename Process 1"">
              <select class="px-2 py-1 mr-2 rounded-md border border-gray-400">
                <template x-for="csvFile in csvFiles">
                  <option x-text="csvFile.filename"></option>
                </template>
              </select>
              <textarea class="py-1 px-2 w-64 resize border border-gray-400 rounded-lg" rows="1" cols="30" placeholder="Enter the equation"></textarea>
            </div>
          </template>
        </div>
        <button class="w-64 flex-none bg-brand text-slate-50 text-sm font-medium px-4 py-2 rounded-md hover:bg-brand/75" onclick="showResult=true;calculate()">Process</button>
      </div>

    </div>


    <!-- Phase 4 -->
    <div x-cloak x-show="processCount > 0" class="flex flex-col px-2 py-4">
      <h3 id="resultsHeader" class="font-bold text-xl mb-2">Results and Interpretation</h3>

      <!-- Calculator results -->
      {% if error %}
      <div class="error">{{ error }}</div>
      {% endif %}
      <div id="results" class="mb-4"></div>


      <div class="mb-2"> Analyzing the results and comparison</div>

      <div class="flex w-full">
        <canvas id="myChart" class="w-full max-w-md"></canvas>
      </div>

      <div>
        <span>Generating a PDF report</span>
        <button type="reportButton" id="generateReport" class="px-2 px-1.5 rounded-lg bg-white border border-gray-400">Generate</button>
      </div>
    </div>
  </div>
</div>

{% endblock %}


{% block scripts %}
<script src="{{ url_for('static', filename='src/calculator.js')}}"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.71/jquery.csv-0.71.min.js"></script>
<script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.6.4/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/select/1.3.1/js/dataTables.select.min.js"></script>
<script src="https://editor.datatables.net/extensions/Editor/js/dataTables.editor.min.js"></script>
{% endblock %}
